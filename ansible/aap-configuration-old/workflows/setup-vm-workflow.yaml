---
- name: "Create VM Creation Request Workflow"
  ansible.controller.workflow_job_template:
    name: "VM Creation Request Workflow"
    description: "Complete workflow for creating VM pull request, waiting for checks, and merging"
    organization: "{{ default_organization }}"
    survey_enabled: true
    survey_spec:
      name: "VM Pull Request Parameters"
      description: "Parameters for creating VM pull request"
      spec:
        - question_name: "VM AMI"
          question_description: "Operating System for the VM"
          required: true
          type: "multiplechoice"
          variable: "vm_ami"
          choices: "{{ ami_choices }}"
          default: "{{ ami_default }}"
        - question_name: "AWS Region"
          question_description: "AWS Region for the VM"
          required: true
          type: "multiplechoice"
          variable: "aws_region"
          choices: "{{ region_choices }}"
          default: "{{ region_default }}"
        - question_name: "VM Size"
          question_description: "Size of the VM instance"
          required: false
          type: "multiplechoice"
          variable: "vm_size"
          choices:
            - "t2.micro"
            - "t2.small"
            - "t2.medium"
            - "t2.large"
            - "t2.xlarge"
            - "t3.micro"
            - "t3.small"
            - "t3.medium"
            - "t3.large"
            - "t3.xlarge"
            - "t3.2xlarge"
            - "m5.large"
            - "m5.xlarge"
            - "m5.2xlarge"
            - "m5.4xlarge"
            - "c5.large"
            - "c5.xlarge"
            - "c5.2xlarge"
            - "c5.4xlarge"
          default: "t2.micro"
        - question_name: "Instance Name"
          question_description: "Name of the VM instance (optional - will generate random name if empty)"
          required: false
          type: "text"
          variable: "instance_name"
          default: ""
        - question_name: "Request ID"
          question_description: "Unique identifier for this request"
          required: false
          type: "text"
          variable: "req_id"

- name: Create workflow node - Create PR
  ansible.controller.workflow_job_template_node:
    identifier: "Create pull request for VM"
    workflow_job_template: "VM Creation Request Workflow"
    unified_job_template: "VM Pull Request - Create PR"

- name: Create workflow node - Merge PR
  ansible.controller.workflow_job_template_node:
    identifier: "Merge pull request for VM"
    workflow_job_template: "VM Creation Request Workflow"
    unified_job_template: "VM Pull Request - Merge PR"

- name: Create workflow node - Get Run Infos
  ansible.controller.workflow_job_template_node:
    identifier: "Get Terraform run information"
    workflow_job_template: "VM Creation Request Workflow"
    unified_job_template: "HCP Terraform - Get Run Infos"

- name: Create workflow node - VM Prepare Machine
  ansible.controller.workflow_job_template_node:
    identifier: "Prepare and configure VM"
    workflow_job_template: "VM Creation Request Workflow"
    unified_job_template: "VM Prepare Machine"

- name: Link workflow nodes - Create PR to Merge PR
  ansible.controller.workflow_job_template_node:
    identifier: "Create pull request for VM"
    workflow_job_template: "VM Creation Request Workflow"
    success_nodes:
      - "Merge pull request for VM"

- name: Link workflow nodes - Merge PR to Get Run Infos
  ansible.controller.workflow_job_template_node:
    identifier: "Merge pull request for VM"
    workflow_job_template: "VM Creation Request Workflow"
    success_nodes:
      - "Get Terraform run information"

- name: Link workflow nodes - Get Run Infos to VM Prepare Machine
  ansible.controller.workflow_job_template_node:
    identifier: "Get Terraform run information"
    workflow_job_template: "VM Creation Request Workflow"
    success_nodes:
      - "Prepare and configure VM"

- name: Create VM Resize Workflow Template
  ansible.controller.workflow_job_template:
    name: "VM Resize Workflow"
    description: "Complete workflow for resizing VM instance type, creating pull request, waiting for checks, and merging"
    organization: "{{ default_organization }}"
    survey_enabled: true
    survey_spec:
      name: "VM Resize Workflow Parameters"
      description: "Parameters for the complete VM resize workflow"
      spec:
        - question_name: "Instance Name to Resize"
          question_description: "Name of the VM instance to resize (must match existing instance)"
          required: true
          type: "text"
          variable: "instance_name_to_resize"
        - question_name: "New Instance Type"
          question_description: "New instance type for the VM"
          required: true
          type: "multiplechoice"
          variable: "new_instance_type"
          choices:
            - "t2.micro"
            - "t2.small"
            - "t2.medium"
            - "t2.large"
            - "t2.xlarge"
            - "t3.micro"
            - "t3.small"
            - "t3.medium"
            - "t3.large"
            - "t3.xlarge"
            - "t3.2xlarge"
            - "m5.large"
            - "m5.xlarge"
            - "m5.2xlarge"
            - "m5.4xlarge"
            - "c5.large"
            - "c5.xlarge"
            - "c5.2xlarge"
            - "c5.4xlarge"
          default: "t3.medium"
        - question_name: "Request ID"
          question_description: "Unique identifier for this request (will be auto-generated if not provided)"
          required: false
          type: "text"
          variable: "req_id"

- name: Create workflow node - Resize Create PR
  ansible.controller.workflow_job_template_node:
    identifier: "Create pull request for VM resize"
    workflow_job_template: "VM Resize Workflow"
    unified_job_template: "VM Resize Pull Request - Create PR"

- name: Create workflow node - Resize Merge PR
  ansible.controller.workflow_job_template_node:
    identifier: "Merge pull request for VM resize"
    workflow_job_template: "VM Resize Workflow"
    unified_job_template: "VM Resize Pull Request - Merge PR"

- name: Link workflow nodes - Resize Create PR to Resize Merge PR
  ansible.controller.workflow_job_template_node:
    identifier: "Create pull request for VM resize"
    workflow_job_template: "VM Resize Workflow"
    success_nodes:
      - "Merge pull request for VM resize"

- name: Create VM Remove Workflow Template
  ansible.controller.workflow_job_template:
    name: "VM Remove Workflow"
    description: "Complete workflow for removing VM instance, creating pull request, waiting for checks, and merging"
    organization: "{{ default_organization }}"
    survey_enabled: true
    survey_spec:
      name: "VM Remove Workflow Parameters"
      description: "Parameters for the complete VM removal workflow"
      spec:
        - question_name: "Instance Name to Remove"
          question_description: "Name of the VM instance to remove (must match existing instance)"
          required: true
          type: "text"
          variable: "instance_name_to_remove"
        - question_name: "Request ID"
          question_description: "Unique identifier for this request (will be auto-generated if not provided)"
          required: false
          type: "text"
          variable: "req_id"

- name: Create workflow node - Remove Create PR
  ansible.controller.workflow_job_template_node:
    identifier: "Create pull request for VM removal"
    workflow_job_template: "VM Remove Workflow"
    unified_job_template: "VM Remove Pull Request - Create PR"

- name: Create workflow node - Remove Merge PR
  ansible.controller.workflow_job_template_node:
    identifier: "Merge pull request for VM removal"
    workflow_job_template: "VM Remove Workflow"
    unified_job_template: "VM Remove Pull Request - Merge PR"

- name: Link workflow nodes - Remove Create PR to Remove Merge PR
  ansible.controller.workflow_job_template_node:
    identifier: "Create pull request for VM removal"
    workflow_job_template: "VM Remove Workflow"
    success_nodes:
      - "Merge pull request for VM removal"
